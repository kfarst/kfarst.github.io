<!DOCTYPE html>
<html>
  <head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Improving the Model Layer in Angular 1 | Kevin Farst&#39;s Blog</title>
<meta name="description" content="Improving the Model Layer in Angular 1">
<meta name="keywords" content="angular,angular1,ui-router,ui.router,es5,javascript">
<link rel="stylesheet" href="/css/main.css">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="theme-color" content="#2ecc71">
<link rel="canonical" href="http://kfarst.github.com/angular/2017/02/14/improving-the-model-layer-in-angular-1/">
<link rel="alternate" type="application/rss+xml" title="Kevin Farst's Blog" href="http://kfarst.github.com/feed.xml" />
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-89422990-1']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
<!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Improving the Model Layer in Angular 1 | Kevin Farst’s Blog</title>
<meta name="generator" content="Jekyll v3.8.0" />
<meta property="og:title" content="Improving the Model Layer in Angular 1" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Improving the Model Layer in Angular 1" />
<meta property="og:description" content="Improving the Model Layer in Angular 1" />
<link rel="canonical" href="http://kfarst.github.com/angular/2017/02/14/improving-the-model-layer-in-angular-1/" />
<meta property="og:url" content="http://kfarst.github.com/angular/2017/02/14/improving-the-model-layer-in-angular-1/" />
<meta property="og:site_name" content="Kevin Farst’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-02-14T13:08:14-08:00" />
<script type="application/ld+json">
{"description":"Improving the Model Layer in Angular 1","@type":"BlogPosting","url":"http://kfarst.github.com/angular/2017/02/14/improving-the-model-layer-in-angular-1/","headline":"Improving the Model Layer in Angular 1","dateModified":"2017-02-14T13:08:14-08:00","datePublished":"2017-02-14T13:08:14-08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://kfarst.github.com/angular/2017/02/14/improving-the-model-layer-in-angular-1/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
  </head>
  <body class="">
    <main class="container">
        <header class="site-header">
  <div class="container txt-center">
    <nav class="navbar">
      <ul>
        <li><a href="/">home</a></li>
        <li class="divider">&bull;</li>
        <li><a href="/about">about</a></li>
        <li class="divider">&bull;</li>
        <li><a href="/feed.xml" target="_blank"><i class="icon icon-feed"></i> feed</a></li>
      </ul>
    </nav>
    <a href="/" class="author-thumb">
      <img src="/images/author.png" alt="Author thumbnail" class="dot">
    </a>
    <h1>Hi, I'm Kevin <small>and I write code :)</small></h1>
    <nav class="navbar">
      <ul>
          <li><a href="/10-mins-of-code/index.html">10 Mins Of Code</a></li>
            <li class="divider">&bull;</li>
          <li><a href="/android/index.html">Android</a></li>
            <li class="divider">&bull;</li>
          <li><a href="/angular/index.html">Angular</a></li>
            <li class="divider">&bull;</li>
          <li><a href="/career/index.html">Career</a></li>
            <li class="divider">&bull;</li>
          <li><a href="/jasmine/index.html">Jasmine</a></li>
            <li class="divider">&bull;</li>
          <li><a href="/open-source/index.html">Open Source</a></li>
            <li class="divider">&bull;</li>
          <li><a href="/react/index.html">React</a></li>
            <li class="divider">&bull;</li>
          <li><a href="/sketch/index.html">Sketch</a></li>
            <li class="divider">&bull;</li>
          <li><a href="/ios/index.html">iOS</a></li>
      </ul>
    </nav>
    <hr class="hr">
  </div>
</header>
        <section class="main-content">
          <article class="post">
  <header class="post-header">
    <h1 class="post-title">Improving the Model Layer in Angular 1</h1>
    <p class="post-meta">Feb 14, 2017</p>
  </header>
  <div class="post-content">
    <p>AngularJS is defined as both an MVC (Model-View-Controller) and an MVVM (Model-View-ViewModel) framework, depending on
how you want to define it or how you want to use it. Two of those concepts are pretty spelled out, the view being what the
user sees in the browser, and the controller obviously being one of the types of Angular modules. Even the view model has a clear
definition you can point to once you know what you’re looking for. We can say that the view model is the collection of objects and
primitives exposed to the view and available through Angular bindings. When we define the view model like so, we realize this
describes the <code>$rootScope</code> and all scopes that inherit from it in controllers and directives (or an isolate scope depending on
how you define the directive).</p>
<h2 id="what-about-the-model">What about the model?</h2>
<p><img src="http://imgur.com/PsTdRlY.png" width="100%" /></p>
<p>The model can be a little tougher to pinpoint in Angular, especially when you first start learning the framework. From Wikipedia,</p>
<blockquote>
  The model is the central component of the pattern. It expresses the application's behavior in terms of the problem domain,
  independent of the user interface. It directly manages the data, logic and rules of the application.
</blockquote>
<p>If you’re interacting with an API, it <em>should</em> be sending, receiving, and validating data to and from your Angular app. However,
if your API is not that sophisticated, or perhaps you are only using a basic data store for your data, we need a way of representing
the data management, logic, and rules inside our front-end application. Since a <em>service</em> or <em>factory</em> happens to be a great utility module, we can
use it to create models in our JavaScript. When we receive data from our API or data store, we can pass it into our model, which will provide us
with useful functions and other logic.</p>
<h2 id="why-do-we-need-this">Why do we need this?</h2>
<p>First, let’s look at an example. Let’s say that we have an <code>OrderModel</code>, and an order has different statuses based off of user actions.</p>
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span>  <span class="p">...</span>
  <span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;OrderModel&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
       <span class="nx">isCancelled</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
         <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="s1">&#39;cancelled&#39;</span><span class="p">;</span>
       <span class="p">},</span>
       <span class="nx">isShipped</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
         <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="s1">&#39;shipped&#39;</span><span class="p">;</span>
       <span class="p">},</span>
       <span class="nx">isProcessing</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
         <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="s1">&#39;processing&#39;</span><span class="p">;</span>
       <span class="p">},</span>
       <span class="nx">decorate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
       <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">});</span></code></pre></figure>
<p>We can then pass our response from the API into this <code>OrderModel</code> and the object will become <em>decorated</em> with our added JavaScript functionality.</p>
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span>  <span class="kd">var</span> <span class="nx">order</span><span class="p">;</span>
  <span class="nx">OrdersApi</span><span class="p">.</span>
    <span class="nx">get</span><span class="p">({</span> <span class="nx">orderID</span><span class="o">:</span> <span class="nx">$stateParams</span><span class="p">.</span><span class="nx">orderID</span> <span class="p">}).</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">order</span> <span class="o">=</span> <span class="nx">OrderModel</span><span class="p">.</span><span class="nx">decorate</span><span class="p">(</span><span class="nx">reponse</span><span class="p">.</span><span class="nx">order</span><span class="p">);</span>
    <span class="p">});</span></code></pre></figure>
<p>Since we are calling <code>angular.extend()</code> to attach the the model logic to the order object, we don’t even need to assign the return value from the
<code>OrderModel</code> to the <code>order</code> variable. We can assign the order to the variable first, <em>then</em> decorate it. The object assigned to the <code>order</code> variable
will now have all the properties and functions from the object returned by the <code>OrderModel</code>.</p>
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span>  <span class="kd">var</span> <span class="nx">order</span><span class="p">;</span>
  <span class="nx">OrdersApi</span><span class="p">.</span>
    <span class="nx">get</span><span class="p">({</span> <span class="nx">orderID</span><span class="o">:</span> <span class="nx">$stateParams</span><span class="p">.</span><span class="nx">orderID</span> <span class="p">}).</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">order</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">order</span><span class="p">;</span>
      <span class="nx">OrderModel</span><span class="p">.</span><span class="nx">decorate</span><span class="p">(</span><span class="nx">order</span><span class="p">);</span>
    <span class="p">});</span></code></pre></figure>
<p>Now, on to our original question, why do we need this? We can simply assign our order to the <code>order</code> variable, then maybe attach it to the <code>$scope</code> to
use in the view.</p>
<figure class="highlight"><pre><code class="language-html" data-lang="html"><span></span>  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ng-if</span><span class="o">=</span><span class="s">&quot;order.status === &#39;shipped&#39;&quot;</span><span class="p">&gt;</span>
    Your order is on its way!
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></code></pre></figure>
<p>On a minor note, this looks a little less clean than</p>
<figure class="highlight"><pre><code class="language-html" data-lang="html"><span></span>  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ng-if</span><span class="o">=</span><span class="s">&quot;order.isShipped()&quot;</span><span class="p">&gt;</span>
    Your order is on its way!
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></code></pre></figure>
<p>but more importantly, what if your domain model changes, and the API starts returning <code>'in-transit'</code> as the status for a shipped order? Suddenly,
you have to go through all of your code where <code>order.status ==== 'shipped'</code> and update it, whereas if you had the logic in one place, the model,
you could simply change the function to</p>
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span>  <span class="nx">isShipped</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="s1">&#39;in-transit&#39;</span><span class="p">;</span>
  <span class="p">}</span></code></pre></figure>
<p>Maybe the order object will change properties altogether, so you now have an <code>isShipped</code> flag instead of the <code>status</code> property….</p>
<p>OK, so maybe your IDE can do all of this for you with one simple command, but that ends up being more code you have to review rather than
focusing on regression testing your simple change within the model.</p>
<h2 id="oh-that-reminds-me">Oh! That reminds me…</h2>
<p>Speaking of <em>testing</em>, that brings up another point. When you check the <code>status</code> property on the object inside a view, let’s say the view of a directive, and
you write unit tests for that directive that explicitly include knowledge of the raw data coming back from the API, you are almost forcing “white box
testing” on yourself. You have to have intimate low-level knowledge in a context that’s not needed, not to mention the directive having to know
more than it needs to.</p>
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span>  <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Directive: Order Status&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">order</span><span class="p">;</span>
    <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">order</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="s1">&#39;shipped&#39;</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="p">...</span>
  <span class="p">});</span></code></pre></figure>
<p>As you’re setting up your tests, you may find that using the <code>status</code> property at face values makes you do more work than needed. Initially, you want
to have two test cases to cover when the order is shipped and the order is not shipped. For your first test you mock out an order and set the status to <code>'shipped'</code>,
but then you think about the second test. You know that it won’t be shipped when the status is not <code>'shipped'</code>, but do you want to insert a garbage value
or an actual order status, rather than simply one that isn’t <code>'shipped'</code>? This brings up another issue, should we add an additional test for both an actual non-shipped order
status <em>and</em> a garbage value? What about when the status is an empty string? Using an <code>isShipped()</code> model function that returns a boolean will cover any non-shipped state,
garbage value, <code>null</code> value, <code>undefined</code> value, emptry string value, etc. Really, these should all be test cases that belong in the <code>OrderModel</code> unit tests anyway. Again, we are
giving too much responsibility to both the actual directive as well as our unit tests.</p>
<h2 id="why-else-is-this-important">Why else is this important?</h2>
<p>In the end, the directive only cares about whether an order is shipped or not, not what the specific value of the order status
is. This helps you <em>decouple</em> the dependency of the order data from the directive. This can give us an additional advantage, because let’s say we have
another data object which we also want to display the <code>status</code> in the view. We’ll say we have an <code>Order</code> and a <code>Gift</code> type, and both have the concept of
being shipped. However, like the earlier mentioned potiential issue, what if one has a <code>status</code> property returning text, and the other has a flag <code>isShipped</code>?
Without a model, we can either created another directive that does pretty much the same thing, or we can re-use the same directive and end up having
to handle multiple cases for displaying the status inside the directive.</p>
<p><img src="http://i.imgur.com/pFBNGaA.png" width="100%" /></p>
<p>Maybe this isn’t too painful yet, but what if you want to use that functionality elsewhere? Not to mention it tightly couples either one of these data types
to the directive. On the flip side, if both the <code>Order</code> and <code>Gift</code> have an <code>OrderModel</code> and <code>GiftModel</code>, they can both have the same interface for the directive.
If both models have a function <code>isShipped()</code>, the directive won’t care what type the object passed into the scope is, just that it responds to the <code>isShipped()</code>
function. Finally, we won’t even need to add a function into the directive, we can call the model’s function in the directive’s view directly.</p>
<p><img src="http://imgur.com/ST9f0K8.png" width="100%" /></p>
<h2 id="data-transformation">Data transformation</h2>
<p>There are a lot of great articles discussing everything I’ve explained so far (and even more in depth), however one thing I feel that these articles should
definitely emphasize more is the serialization and de-serialization of data to and from the API, and the benefits of using a model to do so. Even if you aren’t
doing any particularly complex data manipulations, sometimes it’s just a matter of converting your snake-cased property keys into camel case and back again.
Ideally, our <code>decorate()</code> function would not only attach useful functions and additional properties to our server-returned object, but also transform the
data into a more JavaScript-friendly version. To transform the data back, we could add a <code>serialize()</code> function to convert it back into a form that our API
is happy with.</p>
<p>It would also be nice if this functionality had a common and re-usable interface. What if we have nested models we want to serialize also? We can accomplish
both of these purposes with one service which we can inject into our models. Let’s take a look at the <code>serializable</code> service, which we’ll build out
using <a href="https://lodash.com/">Lodash</a>, a library that offers us additional useful utility functions.</p>
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="p">...</span>
<span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;serializable&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">      Set up list of serializers on the model, where</span>
<span class="cm">      the first element is a function that returns the</span>
<span class="cm">      model object</span>
<span class="cm">    */</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">_serializers</span> <span class="o">=</span> <span class="p">[</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">delete</span> <span class="nx">object</span><span class="p">.</span><span class="nx">_serializers</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">object</span><span class="p">;</span>
    <span class="p">}];</span>
    <span class="cm">/*</span>
<span class="cm">      Pass the model into each serializer, and the result</span>
<span class="cm">      from each function is passed into the next serializer</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">_executeSerializers</span><span class="p">(</span><span class="nx">serializers</span><span class="p">,</span> <span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">flowRight</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">serializers</span><span class="p">)(</span><span class="nx">object</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/*</span>
<span class="cm">      For each key in our model:</span>
<span class="cm">      - If it is a property on the model and it has a serialize</span>
<span class="cm">        function, call the function and assign it as the new value</span>
<span class="cm">        for the property</span>
<span class="cm">      - If the property is an object in itself, pass the object</span>
<span class="cm">        recursively into the serializeChildren() function</span>
<span class="cm">    */</span>
    <span class="kd">function</span> <span class="nx">serializeChildren</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">object</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">object</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">object</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">serialize</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">object</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">object</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">serialize</span><span class="p">();</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">object</span><span class="p">[</span><span class="nx">key</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nx">serializeChildren</span><span class="p">(</span><span class="nx">object</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">object</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Attach the serialize() and addSerializer() functions to the model object</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">serialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">executeSerializers</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">partial</span><span class="p">(</span><span class="nx">_executeSerializers</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_serializers</span><span class="p">);</span>
        <span class="cm">/*</span>
<span class="cm">          Copy the original model object so as to not cause issues with view bindings</span>
<span class="cm">          and multiple serializations. Then, serialize any nested models within the model</span>
<span class="cm">          object, and finally pass that result to the list of serializers on the model itself</span>
<span class="cm">        */</span>
        <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">flowRight</span><span class="p">(</span><span class="nx">executeSerializers</span><span class="p">,</span> <span class="nx">serializeChildren</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cloneDeep</span><span class="p">)(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">addSerializer</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_serializers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">fn</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">});</span></code></pre></figure>
<p>There’s a lot going on in this <code>serializable</code> service, but hopefuly the inline comments and trying it out for yourself will help make a little more sense
of it. To summarize, calling <code>serialize()</code> on the top level model object will serialize itself with any attached serializer functions, as well as
serializing any nested child models assigned to the top level model object as properties. To wrap up, let’s take a look at a simple example.</p>
<h4 id="a-practical-example">A practical example</h4>
<p>Going back to our <code>OrderModel</code>, we’ll also create a <code>LineItemModel</code> as a list of individual products attached to the order.</p>
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span>  <span class="p">...</span>
  <span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;OrderModel&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">serializable</span><span class="p">,</span> <span class="nx">CustomerModel</span><span class="p">,</span> <span class="nx">LineItemModel</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="p">...</span>
      <span class="nx">decorate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Extend model with serializable functionality</span>
        <span class="nx">serializable</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
        <span class="c1">// Any undefined properties on the passed in object</span>
        <span class="c1">// will be assigned a default property if the</span>
        <span class="c1">// default property is listed below</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">status</span><span class="o">:</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span>
          <span class="nx">lineItems</span><span class="o">:</span> <span class="p">[],</span>
          <span class="nx">customer</span><span class="o">:</span> <span class="nx">CustomerModel</span><span class="p">.</span><span class="nx">decorate</span><span class="p">({</span>
            <span class="nx">status</span><span class="o">:</span> <span class="s1">&#39;new&#39;</span>
          <span class="p">})</span>
        <span class="p">});</span>
        <span class="c1">// Decorate any line items with their own model</span>
        <span class="nx">lineItems</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">lineItem</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">LineItemModel</span><span class="p">.</span><span class="nx">decorate</span><span class="p">(</span><span class="nx">lineItem</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="nx">obj</span><span class="p">.</span><span class="nx">addSerializer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}).</span>
  <span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;LineItemModel&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">serializable</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">transformPropNames</span> <span class="p">(</span><span class="nx">originalFormat</span><span class="p">,</span> <span class="nx">newFormat</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">originalFormat</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">);</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Use regex to ensure original argument is a property</span>
        <span class="c1">// name suffix</span>
        <span class="k">return</span> <span class="nx">key</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">);</span>
      <span class="p">}).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">originalKey</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Add new key with original value and transformed</span>
        <span class="c1">// name, delete the original key-value pair</span>
        <span class="nx">obj</span><span class="p">[</span><span class="nx">originalKey</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">originalFormat</span><span class="p">,</span> <span class="nx">newFormat</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">originalKey</span><span class="p">];</span>
        <span class="k">delete</span><span class="p">[</span><span class="nx">originalKey</span><span class="p">];</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">retun</span> <span class="p">{</span>
      <span class="p">...</span>
      <span class="nx">decorate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">serializable</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
        <span class="c1">// Transform snake case ID properties into camel case</span>
        <span class="nx">transformPropNames</span><span class="p">(</span><span class="s1">&#39;_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">);</span>
        <span class="nx">obj</span><span class="p">.</span><span class="nx">addSerializer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// Transform camel case ID properties back into snake case</span>
          <span class="nx">transformPropNames</span><span class="p">(</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;_id&#39;</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">});</span></code></pre></figure>
<p>In the <code>OrderModel</code>, when we decorate the object we are:</p>
<ul>
  <li>Using Lodash to provide default values for properties</li>
  <li>Initializing a default property with a decorated model (customer)</li>
  <li>Decorating existing nested objects (line items)</li>
</ul>
<p>In the <code>LineItemModel</code>, for both decorating and serializing the object we are:</p>
<ul>
  <li>Transforming ID properties from one case to another</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>A lot has been covered in this article and although you may very well have read
about some aspects of what I’ve covered, ideally you’ll have found a few helpful
hints at the least, and perhaps some useful code snippets to try out and incorporate
into your own projects. Please share any questions or comments you have, and thanks
for reading!</p>
    <aside class="share">
      <span>Share this: </span>
      <a href="http://twitter.com/share?text=Improving the Model Layer in Angular 1&amp;url=http://kfarst.github.com/angular/2017/02/14/improving-the-model-layer-in-angular-1/&amp;hashtags=web,dev,blog&amp;via=kevinfarst"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <i class="icon icon-twitter-rounded"></i>
      </a>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://kfarst.github.com/angular/2017/02/14/improving-the-model-layer-in-angular-1/"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <i class="icon icon-facebook-rounded"></i>
      </a>
    </aside>
  </div>
  <hr>
  <aside id="comments" class="disqus">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname, disqus_config;
      var disqus_script_tag = setTimeout(function () {
        if ('/angular/2017/02/14/improving-the-model-layer-in-angular-1') {
          disqus_shortname = 'kfarst';
          disqus_config = function () {
            this.page.identifier = 'http://kfarst.github.com/angular/2017/02/14/improving-the-model-layer-in-angular-1';
            this.page.title = 'Improving the Model Layer in Angular 1';
            this.page.url = 'http://kfarst.github.com/angular/2017/02/14/improving-the-model-layer-in-angular-1';
            /*var disqus_developer = 1;*/
          };
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        } else {
          disqus_script_tag();
        }
      }, 1000);
    </script>
    <noscript>
      Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
    </noscript>
  </aside>
</article>
        </section>
<div class="clearfix"></div>
<footer class="site-footer txt-center">
  <hr>
  <ul class="social">
        <li><a href="" target="_blank"><i class="icon icon-"></i></a></li>
        <li><a href="http://kfarst.github.com" target="_blank"><i class="icon icon-github"></i></a></li>
        <li><a href="" target="_blank"><i class="icon icon-"></i></a></li>
        <li><a href="http://twitter.com/kevinfarst" target="_blank"><i class="icon icon-twitter"></i></a></li>
        <li><a href="" target="_blank"><i class="icon icon-"></i></a></li>
        <li><a href="https://www.linkedin.com/in/kevin-farst-14a63914" target="_blank"><i class="icon icon-linkedin"></i></a></li>
  </ul>
  <small>&copy; 2019 All rights reserved. Made with <a href="http://jekyllrb.com" target="_blank">Jekyll</a> and <i class="icon icon-heart"></i></small>
  <small>by <a href="http://nandomoreira.me" target="_blank">nandomoreira.me</a></small>
</footer>
    </main>
    <a href="http://github.com/kfarst" target="_blank" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#2ecc71; color:#f7f8f9; position: absolute; top: 0; border: 0; right: 0;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>
  </body>
</html>
